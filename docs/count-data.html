<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title> 5 Models for count data | RHUL Psychology Statistical modelling notebook</title>
<meta name="author" content="Matteo Lisi">
<meta name="description" content="This section will provide some examples of models that can deal with count data. Typically, count data occurs when the dependent variable is the counted number of occurrences of an event - for...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content=" 5 Models for count data | RHUL Psychology Statistical modelling notebook">
<meta property="og:type" content="book">
<meta property="og:url" content="https://mlisi.xyz/RHUL-stats/count-data.html">
<meta property="og:image" content="https://mlisi.xyz/RHUL-stats/images/pop_brain.png">
<meta property="og:description" content="This section will provide some examples of models that can deal with count data. Typically, count data occurs when the dependent variable is the counted number of occurrences of an event - for...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content=" 5 Models for count data | RHUL Psychology Statistical modelling notebook">
<meta name="twitter:description" content="This section will provide some examples of models that can deal with count data. Typically, count data occurs when the dependent variable is the counted number of occurrences of an event - for...">
<meta name="twitter:image" content="https://mlisi.xyz/RHUL-stats/images/pop_brain.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">RHUL Psychology
Statistical modelling notebook</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> About</a></li>
<li><a class="" href="surveys.html"><span class="header-section-number">2</span> Departmental survey about statistical methods</a></li>
<li><a class="" href="intro-R.html"><span class="header-section-number">3</span> Introduction to R</a></li>
<li><a class="" href="linear-models.html"><span class="header-section-number">4</span> Linear models</a></li>
<li><a class="active" href="count-data.html"><span class="header-section-number">5</span> Models for count data</a></li>
<li><a class="" href="ordinal.html"><span class="header-section-number">6</span> Models for ordinal data</a></li>
<li><a class="" href="meta-analysis.html"><span class="header-section-number">7</span> Meta-analyses</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">8</span> Missing data</a></li>
<li><a class="" href="SDT.html"><span class="header-section-number">9</span> Signal Detection Theory</a></li>
<li><a class="" href="useful-links-resources.html"><span class="header-section-number">10</span> Useful links &amp; resources</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mattelisi/RHUL-stats">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="count-data" class="section level1" number="5">
<h1>
<span class="header-section-number"> 5</span> Models for count data<a class="anchor" aria-label="anchor" href="#count-data"><i class="fas fa-link"></i></a>
</h1>
<p>This section will provide some examples of models that can deal with <em>count</em> data. Typically, count data occurs when the dependent variable is the counted number of occurrences of an event - for example the number of patients arriving in an emergency department (A&amp;E) in a given time of the day - e.g. between 10:00 and 11:00. In this case, the dependent variable (the number of patients) has several characteristics that make it unsuitable for analysis with standard linear models such as linear regression: their distribution is discrete, composed only of non-negative integers, and is often positively skewed, with many observations having a value of 0.</p>
<p>Another characteristic is that the variance of the observations (e.g. the variance of the number of counts across observations within the same condition) increases with their expected value (e.g. the average number of counts for that condition)<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;This makes sense if you think that when the expected number of counts is very low, say &lt;span class="math inline"&gt;\(\approx 1\)&lt;/span&gt;, there cannot be many observations with very high counts - otherwise their average wouldn’t be as low (recall that counts are strictly non-negative). In other words, the variance must be low when the average is also low.&lt;/p&gt;'><sup>8</sup></a>.</p>
<div id="poisson-model" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Poisson model<a class="anchor" aria-label="anchor" href="#poisson-model"><i class="fas fa-link"></i></a>
</h2>
<p>The simplest model that account for the characteristics mentioned above is a generalized linear model that assume a dependent variable with a <a href="https://en.wikipedia.org/wiki/Poisson_distribution">Poisson distribution</a>. The Poisson distribution has a single free parameter, usually notated with <span class="math inline">\(\lambda\)</span>, which gives both the expected value (the mean) and the variance of the count variable. In fact it assumes that the variance has the same value as the mean.</p>
<p>Formally, a Poisson model is usually formulated as follow: let <span class="math inline">\(y=(y_1, \dots, y_n)\)</span> be the dependent variable, consisting of counts (non-negative integers) and <span class="math inline">\(x\)</span> the independent variable (predictor). Then</p>
<p><span class="math display">\[
y_i \sim \text{Poisson} \left(\lambda_i \right)
\]</span>
where<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;This is the most common formulation, and is sometime referred to as log ‘link’ function, to indicate the fact that we have a function (the logarithm function) that ‘link’ the linear part of the model (the linear combination of the independent variables, here &lt;span class="math inline"&gt;\(\beta_0 + \beta_1 x_i\)&lt;/span&gt;) with the parameter of the distribution of the dependent variable (here the Poisson rate parameter &lt;span class="math inline"&gt;\(\lambda\)&lt;/span&gt;). This is a common component to all generalized linear models, for example for the logistic regression we have a ‘logit’ link function - the quantile function of the standard logistic distribution - that link the linear predictor part with the parameter &lt;span class="math inline"&gt;\(p\)&lt;/span&gt; of the binomial distribution.&lt;/p&gt;'><sup>9</sup></a>
<span class="math display">\[
\log( \lambda_i) = \beta_0 + \beta_1 x_i
\]</span>
or alternatively
<span class="math display">\[
\lambda_i = e^{\beta_0 + \beta_1 x_i}
\]</span>
Which indicates that we can use the exponential function (in R the function <code><a href="https://rdrr.io/r/base/Log.html">exp()</a></code>) to calculate the predicted values of the mean (more precisely, the expected value, <span class="math inline">\(\mathbb{E}(y)\)</span>) and variance (<span class="math inline">\(Var(y)\)</span>) of the dependent variable. This relies on the property of the Poisson distribution<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;The symbol &lt;span class="math inline"&gt;\(\implies\)&lt;/span&gt; is used to denote logical implication, e.g. &lt;span class="math inline"&gt;\((A=B)\implies (B=A)\)&lt;/span&gt; - symmetry of logical equivalence.&lt;/p&gt;'><sup>10</sup></a>
<span class="math display">\[
y_i \sim \text{Poisson} \left(\lambda \right) \implies \mathbb{E}(y)=Var(y)=\lambda
\]</span></p>
<p>However, in practice, data often do not conform to the constraint of having identical mean and variance. Often the observed variance of the count is higher than what predicted according to the Poisson model (we say in this case that the data is <em>over-dispersed</em>).</p>
<div class="rmdnote">
<p><em>How does over-dispersion look like?</em></p>
<p>The type of data expected under a Poisson model is illustrated in the figure below, which shows 100 datapoints simulated from the model <span class="math inline">\(y_i \sim \text{Poisson} \left(e^{1 + 2x_i }\right)\)</span>. The vertical deviations of the datapoints from the line are consistent with the property of the Poisson distribution that the variance of hte count has the same value as their expected value, formally, <span class="math inline">\(Var(y) = \mathbb{E}(y)\)</span>).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">1.3</span>, <span class="fl">1.3</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">linpred</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span><span class="op">*</span><span class="va">x</span> <span class="co"># linear predictor part</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">linpred</span><span class="op">)</span><span class="op">)</span> <span class="co"># simulate Poisson observations</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="co"># plot</span></span>
<span><span class="va">x_</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">x_</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">a</span><span class="op">+</span><span class="va">b</span><span class="op">*</span><span class="va">x_</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html">segments</a></span><span class="op">(</span><span class="va">x</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">a</span><span class="op">+</span><span class="va">b</span><span class="op">*</span><span class="va">x</span><span class="op">)</span>,<span class="va">x</span>,<span class="va">y</span>, lwd<span class="op">=</span><span class="fl">1</span>,lty<span class="op">=</span><span class="fl">3</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-count-data_files/figure-html/unnamed-chunk-2-1.png" width="384" style="display: block; margin: auto;"></div>
<p>We can adjust the code above to simulate the same data with some degree of over-dispersion, using a negative binomial distribution, for different values of the precision parameter theta (<span class="math inline">\(\theta\)</span>), which regulate the degree of overdispersion. Importantly, these datapoints are simulated assuming the same function fo the average (expected) number of counts (same also as the previous figure), they just differe in the amount of overdispersion relative to a Poissone model. Note that for value arbitrarily large of the precision parameter <span class="math inline">\(\theta \rightarrow \infty\)</span> (bottom-right panel) the negative binomial converges to the Poisson.</p>
<div class="inline-figure"><img src="04-count-data_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="negative-binomial-model" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Negative binomial model<a class="anchor" aria-label="anchor" href="#negative-binomial-model"><i class="fas fa-link"></i></a>
</h2>
<p>As mentioned above, data are often overdispersed relative to the Poisson (that is, their variance is larger than the mean). This is an issue because when the data are overdispersed then our results may be largely influences by few extreme datapoints. Moreover, we will have the wrong estimated about the variability of the data. To account for overdispersion we can use the negative binomial which can be seen as a generalization of the Poisson model<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;The name &lt;em&gt;negative binomial&lt;/em&gt; comes from a sampling procedure that give rise to this distribution: basically the negative binomial gives the probability of the number of successes in a sequence of independent and identically distributed Bernoulli trials before a specified (non-random) number of failures occur (this pre-fixed number of failures is a parameter of the negative binomial under an alternative parametrization of this distribution).&lt;/p&gt;"><sup>11</sup></a>.</p>
<p>Formally, the negative binomial model with 1 predictor <span class="math inline">\(x\)</span> can be notated as
<span class="math display">\[
\begin{aligned}
y_i &amp; \sim \text{NegBinomial} \left(\lambda_i, \theta \right)\\
\log( \lambda_i) &amp; = \beta_0 + \beta_1 x_i
\end{aligned}
\]</span></p>
<p>The negative binomial is very similar to the Poisson - in particular it still the case that <span class="math inline">\(\mathbb{E}(y)=\lambda\)</span>. However, it includes an additional precision (or “reciprocal dispersion”) parameter which I referred to as <span class="math inline">\(\theta\)</span><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;I choose ‘theta’ for consistency with the R output but note that this is sometime referred to as &lt;span class="math inline"&gt;\(\phi\)&lt;/span&gt; in the literature &lt;code&gt;¯\_(ツ)_/¯&lt;/code&gt; &lt;/p&gt;'><sup>12</sup></a>. Essentially, whereas for the Poisson we had that <span class="math inline">\(Var(y) = \mathbb{E}(y)\)</span>, now we have that
<span class="math display">\[
Var(y) = \mathbb{E}(y) + \frac{\mathbb{E}(y)^2}{\theta}
\]</span></p>
</div>
<div id="examples" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Examples<a class="anchor" aria-label="anchor" href="#examples"><i class="fas fa-link"></i></a>
</h2>
<div id="anchoring-and-alcohol-units" class="section level3" number="5.3.1">
<h3>
<span class="header-section-number">5.3.1</span> Anchoring and alcohol units<a class="anchor" aria-label="anchor" href="#anchoring-and-alcohol-units"><i class="fas fa-link"></i></a>
</h3>
<p>To see how this would work in practice, I use negative binomial to analyse a dataset that is based on an experiment run by Ryan McKay and his MSc students<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Note that this is not the actual dataset that they collected but just some data that I simulated based on their research idea.&lt;/p&gt;"><sup>13</sup></a>.</p>
<p>The goal of the study was to use the anchoring effect to:</p>
<blockquote>
<p><em>…to see if we could attenuate under-reporting of alcohol consumption (which is a medical problem). Participants in a high-anchor condition were asked “do you drink more or less than 40 units of alcohol a week”, and were then asked to estimate exactly how many units they’d consumed. Those in a low anchor condition were initially asked “do you drink more or less than 4 units of alcohol a week” before giving their precise estimate, and those in a control condition just gave their precise estimate.</em></p>
</blockquote>
<p>In R we begin by loading the data</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"../data/nb_units.csv"</span>, show_col_types <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co"># data availabel in the data folder of the repository</span></span>
<span><span class="va">d</span></span>
<span><span class="co">#&gt; # A tibble: 930 × 3</span></span>
<span><span class="co">#&gt;    gender condition units</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Male   high         10</span></span>
<span><span class="co">#&gt;  2 Male   low           0</span></span>
<span><span class="co">#&gt;  3 Female high          1</span></span>
<span><span class="co">#&gt;  4 Female high          2</span></span>
<span><span class="co">#&gt;  5 Male   high          0</span></span>
<span><span class="co">#&gt;  6 Female low           2</span></span>
<span><span class="co">#&gt;  7 Male   control      23</span></span>
<span><span class="co">#&gt;  8 Female low           2</span></span>
<span><span class="co">#&gt;  9 Female high          1</span></span>
<span><span class="co">#&gt; 10 Male   control       4</span></span>
<span><span class="co">#&gt; # … with 920 more rows</span></span></code></pre></div>
<p>We can calculate the mean and variance of the number of units reported in each conditions. This reveal that the variance across participants in the number of units reported is many times higher than the mean in the number of reported units.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">condition</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>Mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">units</span><span class="op">)</span>,</span>
<span>            Variance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">2</span>,</span>
<span>               caption<span class="op">=</span><span class="st">"Mean and Variance of weekly units of alcohol reported."</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-5">Table 5.1: </span>Mean and Variance of weekly units of alcohol reported.
</caption>
<thead><tr>
<th style="text-align:left;">
condition
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:right;">
Variance
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
control
</td>
<td style="text-align:right;">
7.53
</td>
<td style="text-align:right;">
138.35
</td>
</tr>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:right;">
11.97
</td>
<td style="text-align:right;">
363.69
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:right;">
8.12
</td>
<td style="text-align:right;">
177.05
</td>
</tr>
</tbody>
</table></div>
<p>We can use ggplot2 library to visualize the distributions of reported units in each condition. We can see tha the distribution are skewed and contains many 0, which would make them unsuitable for an analysis with a linear regression model.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">units</span>, fill<span class="op">=</span><span class="va">condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">condition</span><span class="op">~</span><span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="04-count-data_files/figure-html/unnamed-chunk-6-1.png" width="480" style="display: block; margin: auto;"></div>
<p>To estimate the negative-binomial model, we can use the function <code><a href="https://rdrr.io/pkg/MASS/man/glm.nb.html">glm.nb()</a></code> from available in the <code>MASS</code> package. Our predictor condition is categorical with 3 levels and therefore it is coded internally as a set of 2 dummy variables. We can see how the contrast is set using</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span><span class="op">$</span><span class="va">condition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">condition</span><span class="op">)</span> <span class="co"># tell R that this is a categorical factor</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/contrasts.html">contrasts</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">condition</span><span class="op">)</span></span>
<span><span class="co">#&gt;         high low</span></span>
<span><span class="co">#&gt; control    0   0</span></span>
<span><span class="co">#&gt; high       1   0</span></span>
<span><span class="co">#&gt; low        0   1</span></span></code></pre></div>
<p>This indicate that <code>control</code> is our baseline condition and the model will have 2 coefficients that code for the difference in the <code>high</code> and <code>low</code> anchoring condition relative to the control one.</p>
<p>Note also that for this analysis the variable <code>units</code> must contain only integer values - if participants reported non-integer values (e.g. a bottle of lager is about 1.7 units) we could divide everything by the minimum common denominator so that we end up with integer values.</p>
<p>The following command can be used to estimate the model and examine the results</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'MASS'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     select</span></span>
<span><span class="va">nb01</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glm.nb.html">glm.nb</a></span><span class="op">(</span><span class="va">units</span> <span class="op">~</span> <span class="va">condition</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">nb01</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm.nb(formula = units ~ condition, data = d, init.theta = 0.3852966632, </span></span>
<span><span class="co">#&gt;     link = log)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -1.6347  -1.5261  -0.5620   0.1311   2.5895  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)    2.01856    0.09396  21.482  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; conditionhigh  0.46365    0.13218   3.508 0.000452 ***</span></span>
<span><span class="co">#&gt; conditionlow   0.07564    0.13255   0.571 0.568251    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for Negative Binomial(0.3853) family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 1040.0  on 929  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 1025.2  on 927  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 5656.8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Theta:  0.3853 </span></span>
<span><span class="co">#&gt;           Std. Err.:  0.0196 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  2 x log-likelihood:  -5648.7830</span></span></code></pre></div>
<p>We can see from output that the condition <code>high</code> anchoring elicited reports with higher number of alcohol units than the <code>control</code> condition.</p>
<p>We can use the model to make a more precise statement about the size of the difference. We can use the value of the coefficients to calculate the predicted values of counts. The exact values of the coefficients can be accessed from the fitted model using the <code>$</code> operator</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nb01</span><span class="op">$</span><span class="va">coefficients</span></span>
<span><span class="co">#&gt;   (Intercept) conditionhigh  conditionlow </span></span>
<span><span class="co">#&gt;    2.01856406    0.46365080    0.07563937</span></span></code></pre></div>
<p>The values are combined together according to the dummy variables coding for the condition and represents the linear predictor part of the model:</p>
<p><span class="math display">\[
\lambda_i = \exp \left(\beta_0 + \beta_1\times D_\text{high}+ \beta_2\times D_\text{low} \right)
\]</span>
where I have used the notation <span class="math inline">\(D_\text{high}\)</span> and <span class="math inline">\(D_\text{low}\)</span> to indicate the two dummy variable, whose value is 1 for observation in the <code>high</code> and <code>low</code> conditions, respectively, and zero otherwise.</p>
<p><span class="math inline">\(\beta_0\)</span> is a common notation for the intercept parameter - in this case it gives the expected number of alcohol units in the control condition (because for observations in the control condition we have that <span class="math inline">\(D_\text{high}= D_\text{low}=0\)</span>). Thus our model predict an average number of counts in the control condition of</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">nb01</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span><span class="op">)</span> <span class="co"># equivalent to exp(nb01$coefficients[1])</span></span>
<span><span class="co">#&gt; (Intercept) </span></span>
<span><span class="co">#&gt;    7.527508</span></span></code></pre></div>
<p>(Compare this value with the table above).</p>
<p>Furthermore, our models tells us also that the number of reported alcohol units increase multiplicatively in the <code>high</code> condition by a factor of</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">nb01</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"conditionhigh"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; conditionhigh </span></span>
<span><span class="co">#&gt;      1.589868</span></span></code></pre></div>
<p>In fact the predicted number of counts in the <code>high</code> condition can be derived from the model as</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">nb01</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span><span class="op">)</span>  <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">nb01</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"conditionhigh"</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="co">#&gt; (Intercept) </span></span>
<span><span class="co">#&gt;    11.96774</span></span></code></pre></div>
<p>or equivalently</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">nb01</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span> <span class="op">+</span> <span class="va">nb01</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"conditionhigh"</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="co">#&gt; (Intercept) </span></span>
<span><span class="co">#&gt;    11.96774</span></span></code></pre></div>
<p>Finally, note that we can use the <code>sjPlot</code> library to prepare a fancy version of the model output, and we can see that the multiplicative factor that describe the increase in reported units is called here an <em>incidence ratio</em><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Although honestly I am not sure how common is this terminology&lt;/p&gt;"><sup>14</sup></a>.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://strengejacke.github.io/sjPlot/">sjPlot</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Install package "strengejacke" from GitHub (`devtools::install_github("strengejacke/strengejacke")`) to load all sj-packages at once!</span></span>
<span><span class="fu"><a href="https://strengejacke.github.io/sjPlot/reference/tab_model.html">tab_model</a></span><span class="op">(</span><span class="va">nb01</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table style="border-collapse:collapse; border:none;" class="table table-sm">
<tr>
<th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; ">
 
</th>
<th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; ">
units
</th>
</tr>
<tr>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; ">
Predictors
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
Incidence Rate Ratios
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
CI
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
p
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
(Intercept)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
7.53
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
6.29 – 9.10
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>&lt;0.001</strong>
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
condition [high]
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.59
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.23 – 2.06
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>&lt;0.001</strong>
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
condition [low]
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.08
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.83 – 1.40
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.568
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;">
Observations
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3">
930
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
R<sup>2</sup> Nagelkerke
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.023
</td>
</tr>
</table></div>
<div id="adding-predictors" class="section level4" number="5.3.1.1">
<h4>
<span class="header-section-number">5.3.1.1</span> Adding predictors<a class="anchor" aria-label="anchor" href="#adding-predictors"><i class="fas fa-link"></i></a>
</h4>
<p>The dataset include also information about the gender of the participants. We may hypothesize that male participants drink more than female ones<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;For the sake of the example we use only 2 gender categories, but in a real study we should be mindful to include more options for non-binary / third gender participants, as McKay’s students did in the real study.&lt;/p&gt;"><sup>15</sup></a>. Does taking this into account improve the accuracy of our modelling?</p>
<p>To test this, we can estimate an additional model with also gender as predictor. We can compare this to the previous one using a <em>likelihood-ratio test</em>. This is based on a <a href="https://en.wikipedia.org/wiki/Wilks%27_theorem">theorem</a> which states that the difference in log-likelihood<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;In this model the parameters are estimated via maximum likelihood, which amounts to choosing the values of the parameters that maximize the probability (likelihood) of the data under the model. Thus when we refer to the log-likelihood of a model we indicate the logarithm of the maximized value of the likelihood function.&lt;/p&gt;"><sup>16</sup></a> between nested models is (asymptotically) distributed according to a Chi-squared distribution, therefore allowing the calculation of a p-value. In R this can be done using the function <code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code>.</p>
<p>First, let’s fit an additional model with the extra predictor <code>gender</code></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nb02</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glm.nb.html">glm.nb</a></span><span class="op">(</span><span class="va">units</span> <span class="op">~</span> <span class="va">condition</span> <span class="op">+</span> <span class="va">gender</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">nb02</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm.nb(formula = units ~ condition + gender, data = d, init.theta = 0.4212084665, </span></span>
<span><span class="co">#&gt;     link = log)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -1.7705  -1.4368  -0.5506   0.1926   2.3480  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)   1.495941   0.105452  14.186  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; conditionhigh 0.426116   0.127159   3.351 0.000805 ***</span></span>
<span><span class="co">#&gt; conditionlow  0.006701   0.127720   0.052 0.958156    </span></span>
<span><span class="co">#&gt; genderMale    0.909721   0.103969   8.750  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for Negative Binomial(0.4212) family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 1115.5  on 929  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 1025.4  on 926  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 5587.9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Theta:  0.4212 </span></span>
<span><span class="co">#&gt;           Std. Err.:  0.0219 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  2 x log-likelihood:  -5577.9060</span></span></code></pre></div>
<p>This indicate that indeed male participants report on average</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">nb02</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"genderMale"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; genderMale </span></span>
<span><span class="co">#&gt;    2.48363</span></span></code></pre></div>
<p>times more units of alcohol per week than females.</p>
<p>We can already see that the difference due to gender is significant, but nevertheless let’s compare them using a likelihood ratio test.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">nb01</span>, <span class="va">nb02</span><span class="op">)</span></span>
<span><span class="co">#&gt; Likelihood ratio tests of Negative Binomial Models</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Response: units</span></span>
<span><span class="co">#&gt;                Model     theta Resid. df    2 x log-lik.</span></span>
<span><span class="co">#&gt; 1          condition 0.3852967       927       -5648.783</span></span>
<span><span class="co">#&gt; 2 condition + gender 0.4212085       926       -5577.906</span></span>
<span><span class="co">#&gt;     Test    df LR stat. Pr(Chi)</span></span>
<span><span class="co">#&gt; 1                              </span></span>
<span><span class="co">#&gt; 2 1 vs 2     1 70.87633       0</span></span></code></pre></div>
<p>Here the value of the likelihood ratio statistic is NA, 70.88 and under the null hypothesis that any improvement of model fit obtained after adding gender as predictor is due to chance is distributed as a Chi-square with 1 degree of freedom.</p>
</div>
<div id="plotting-model-fit" class="section level4" number="5.3.1.2">
<h4>
<span class="header-section-number">5.3.1.2</span> Plotting model fit<a class="anchor" aria-label="anchor" href="#plotting-model-fit"><i class="fas fa-link"></i></a>
</h4>
<p>It’s not straightforward to visualize the model fit to the data - the code below give one possibility:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># here I make a new data matric for claculating the prediction of the model</span></span>
<span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>condition<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">condition</span><span class="op">)</span>, </span>
<span>                  units <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">units</span><span class="op">)</span>,</span>
<span>                  KEEP.OUT.ATTRS <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use the predict() function to calculate the predicted counts for each condition</span></span>
<span><span class="va">nd</span><span class="op">$</span><span class="va">predicted_units</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">nb01</span>, newdata<span class="op">=</span><span class="va">nd</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># here I use the dnbinom() function - which gives the probability density of </span></span>
<span><span class="co"># the negative binomial - to calculate the probability of the observations under the model</span></span>
<span><span class="va">nd</span><span class="op">$</span><span class="va">pred_density</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html">dnbinom</a></span><span class="op">(</span><span class="va">nd</span><span class="op">$</span><span class="va">units</span>, mu<span class="op">=</span><span class="va">nd</span><span class="op">$</span><span class="va">predicted_units</span>, size<span class="op">=</span><span class="va">nb01</span><span class="op">$</span><span class="va">theta</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># finally take all together and plot</span></span>
<span><span class="va">d</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">units</span>, fill<span class="op">=</span><span class="va">condition</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y<span class="op">=</span><span class="va">..density..</span><span class="op">)</span>,binwidth<span class="op">=</span><span class="fl">1</span>, color<span class="op">=</span><span class="st">"white"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data<span class="op">=</span><span class="va">nd</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">units</span>, y<span class="op">=</span><span class="va">pred_density</span><span class="op">)</span>,size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">condition</span><span class="op">~</span><span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">40</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-18"></span>
<img src="04-count-data_files/figure-html/unnamed-chunk-18-1.png" alt="The black line represent the predicted probability of the data (note that I clipped the x-axis at 40)" width="480"><p class="caption">
Figure 5.1: The black line represent the predicted probability of the data (note that I clipped the x-axis at 40)
</p>
</div>
<p>Admittedly the probability of the data under the model (the black lines) looks quite similar across the three panels, however, the model does assign higher probability to higher count values in the <code>high</code> condition compared to the other ones - we can see this by putting them together in the same panel, and by plotting the logarithm of the probability instead of the probability itself. These changes in the probability of the data may not seems large when looked at in this way, but they amount to quite substantial changes in the average number of counts - recall that in the <code>high</code> condition participants reported on average nearly 1.6 times the number of alcohol units than in the control condition.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">units</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">pred_density</span><span class="op">)</span>, color<span class="op">=</span><span class="va">condition</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>size<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">40</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>,<span class="op">-</span><span class="fl">1.4</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>y<span class="op">=</span><span class="st">"log (probability)"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-count-data_files/figure-html/unnamed-chunk-19-1.png" width="480" style="display: block; margin: auto;"></div>

</div>
</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="linear-models.html"><span class="header-section-number">4</span> Linear models</a></div>
<div class="next"><a href="ordinal.html"><span class="header-section-number">6</span> Models for ordinal data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#count-data"><span class="header-section-number">5</span> Models for count data</a></li>
<li><a class="nav-link" href="#poisson-model"><span class="header-section-number">5.1</span> Poisson model</a></li>
<li><a class="nav-link" href="#negative-binomial-model"><span class="header-section-number">5.2</span> Negative binomial model</a></li>
<li>
<a class="nav-link" href="#examples"><span class="header-section-number">5.3</span> Examples</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#anchoring-and-alcohol-units"><span class="header-section-number">5.3.1</span> Anchoring and alcohol units</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mattelisi/RHUL-stats/blob/main/RHUL-stats-notebook/04-count-data.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mattelisi/RHUL-stats/edit/main/RHUL-stats-notebook/04-count-data.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>RHUL Psychology
Statistical modelling notebook</strong>" was written by Matteo Lisi. It was last built on 2022-08-09.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
